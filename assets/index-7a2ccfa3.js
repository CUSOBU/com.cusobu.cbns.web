import{w as n,Z as $,$ as R,r as i,Q as y,R as z,j as e,a0 as O,a1 as g,I as m,a2 as F,a3 as G,a4 as B,a5 as L,a6 as q,a7 as M,a8 as W,a9 as Q,o as U,T as V,aa as X,p as A,ab as Z,G as d,B as H,V as J,X as K,ac as Y}from"./index-01f55b81.js";import{d as w}from"./Add-5fbbc4a0.js";const b=({row:a,setFetchDataFlag:t})=>{const{openDialog:l}=$(R),[h,c]=i.useState(!1),[r,f]=i.useState(""),[u,p]=i.useState(""),[x,j]=i.useState(!1),[C,D]=i.useState(!1),s=new y(z.api_url,localStorage.getItem("token")||""),o=i.useMemo(()=>{const S=sessionStorage.getItem("roles").toString();return S==="admin"||S==="provider"},[sessionStorage.getItem("roles")]),N=()=>{l(a)},T=async()=>{console.log(`Se obtiene el elemento ${a.id}`),await s.patch(`/topuporders/setstatus/${a==null?void 0:a.id}`,{status:"Delivery",statusCode:1,provider:sessionStorage.user}),t(!0)},_=async()=>{console.log(`Se libera el elemento ${a.id}`),await s.patch(`/topuporders/setstatus/${a==null?void 0:a.id}`,{status:"Pending",statusCode:0,provider:sessionStorage.user}),t(!0)},v=()=>{c(!1)},k=async()=>{if(r)j(!1);else{j(!0);return}D(!0),u==="Cancelar"?await s.patch(`/topuporders/setstatus/${a==null?void 0:a.id}`,{status:"Cancel",statusCode:4,evidence:r}):u==="Completar"&&await s.patch(`/topuporders/setstatus/${a==null?void 0:a.id}`,{status:"Complete",statusCode:3,provider:sessionStorage.user,evidence:r}),t(!0),D(!1),v()},E=()=>{c(!0),p("Completar")},P=()=>{c(!0),p("Cancelar")};return e.jsxs(O,{direction:"row",spacing:1,children:[e.jsx(g,{title:"Details",children:e.jsx(m,{"aria-label":"Details",size:"large",onClick:N,sx:{margin:0,padding:0},children:e.jsx(F,{fontSize:"inherit"})})}),a.status==="Pending"&&!!o&&e.jsx(e.Fragment,{children:e.jsx(g,{title:"Get",children:e.jsx(m,{color:"secondary","aria-label":"Get",size:"large",sx:{margin:0,padding:0},onClick:T,children:e.jsx(G,{fontSize:"inherit"})})})}),a.status==="Delivery"&&!!o&&e.jsxs(e.Fragment,{children:[e.jsx(g,{title:"Release",children:e.jsx(m,{color:"info","aria-label":"Release",size:"large",onClick:_,sx:{margin:0,padding:0},children:e.jsx(B,{fontSize:"inherit"})})}),e.jsx(g,{title:"Cancel",children:e.jsx(m,{color:"error","aria-label":"Cancel",size:"large",onClick:P,sx:{margin:0,padding:0},children:e.jsx(L,{fontSize:"inherit"})})}),e.jsx(g,{title:"Confirm",children:e.jsx(m,{color:"secondary","aria-label":"Confirm",size:"large",sx:{margin:0,padding:0},onClick:E,children:e.jsx(q,{fontSize:"inherit"})})})]}),e.jsxs(M,{open:h,onClose:v,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e.jsxs(W,{id:"alert-dialog-title",children:[u," remesa"]}),e.jsxs(Q,{children:[e.jsx(U,{autoFocus:!0,label:"Evidencia",value:r,onChange:S=>f(S.target.value),fullWidth:!0,sx:{margin:"10px 0"},required:!0}),x&&e.jsx(V,{variant:"caption",color:"error",children:"*Obligatorio"})]}),e.jsxs(X,{children:[e.jsx(A,{onClick:v,children:"Cancelar"}),e.jsx(A,{onClick:k,disabled:C,autoFocus:!0,children:C?e.jsx(Z,{size:24}):"Confirmar"})]})]})]})};b.propTypes={row:n.object.isRequired,setFetchDataFlag:n.func};const ee=(a,t)=>e.jsx(b,{row:a,setFetchDataFlag:t}),ae=[{field:"email",headerName:"Usuario",roles:["admin"],flex:1},{field:"id",headerName:"id",flex:1},{field:"phoneNumber",headerName:"TelÃ©fono",flex:2},{field:"budget",headerName:"Cobrado",numeric:!0,flex:1,roles:["seller","admin"]},{field:"cost",headerName:"Costo",numeric:!0,flex:1,roles:["seller","admin"]},{field:"amount",headerName:"Recarga",numeric:!0,flex:1},{field:"status",headerName:"Estado",flex:2},{field:"provider",headerName:"Proveedor",flex:1,roles:["admin","provider"]},{field:"createdAt",headerName:"Fecha",flex:2},{field:"updatedAt",headerName:"Actualizado",flex:2},{field:"Actions",headerName:"Acciones",type:"actions",width:150,renderCell:ee,roles:["provider","admin"]}],se=a=>ae.filter(t=>!t.roles||t.roles&&t.roles.includes(a)||t.headerName==="Acciones"),I=({status:a,startDate:t,endDate:l,actions:h})=>{const[c,r]=i.useState(!0),[f,u]=i.useState([]),[p,x]=i.useState(!1),j=new y(z.api_url,localStorage.getItem("token")||""),C=async()=>{try{let s=await j.post("/topuporders/filter?page=1&pageSize=20",{status:a,startDate:t,endDate:l});u(await s.data)}catch{r(!1)}};let D=se(sessionStorage.getItem("roles")||"provider");return i.useEffect(()=>{p||(r(!0),C().then(()=>r(!1))),x(!1)},[t,l,a,p]),e.jsxs(d,{container:!0,children:[e.jsx(d,{xs:12,sx:{display:{xs:"block",sm:"none"}},children:f.map((s,o)=>e.jsxs(H,{sx:{border:"1px solid #cccccc",my:1,p:1,borderRadius:2},children:[e.jsx("div",{children:`${s.full_name}`}),e.jsx("div",{children:`${s.phone_number}`}),e.jsx("div",{children:s.cardNumber}),e.jsx("div",{children:`$${s.remittance_amount} ${s.remittance_currency} - $${s.budget_amount} ${s.budget_currency}`}),e.jsx("div",{children:`${s.status}`}),e.jsx(b,{row:s,setFetchDataFlag:x})]},o))}),e.jsx(d,{xs:12,sx:{display:{xs:"none",sm:"block"}},children:e.jsx(J,{data:f,columns:D.map(s=>s.field==="Actions"?{...s,renderCell:o=>e.jsx(b,{row:o.row,setFetchDataFlag:x})}:s),loading:c||!1,page:0,pageSize:20,pageSizeOptions:[5,10,20]})})]})};I.propTypes={status:n.array.isRequired,startDate:n.string,endDate:n.string,actions:n.bool};const te=({status:a})=>{const[t,l]=i.useState({startDate:null,endDate:null}),{openDialog:h}=$(Y);return e.jsxs(d,{container:!0,spacing:2,maxWidth:"xl",children:[e.jsxs(d,{item:!0,xs:12,display:"flex",alignItems:"center",justifyContent:"space-between",mr:3,children:[e.jsx(K,{startDate:t.startDate,endDate:t.endDate,onDateChange:l}),sessionStorage.getItem("roles")==="seller"&&e.jsx(A,{variant:"contained",size:"small",startIcon:e.jsx(w,{}),onClick:h,children:"Crear"})]}),e.jsx(d,{item:!0,xs:12,children:e.jsx(I,{status:a,startDate:t.startDate,endDate:t.endDate})})]})};te.propTypes={status:n.array.isRequired};export{te as default};
